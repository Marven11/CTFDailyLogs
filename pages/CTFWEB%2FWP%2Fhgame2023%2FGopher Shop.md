tags:: [[CTFWEB/整数溢出]]

- # 源码解析
	- 题目是一个商店，用户可以购买或出售物品
	- `A hair of the 4nsw3r`的价格为999999, flag价格为10000000000000000000
	- `user.go`
		- 用户在商店购买物品时，`user.go`会获取购买数量、物品单价两个uint，**将其相乘**，然后和用户的余额（初始为10元）进行对比
		- 如果我们能让两个uint相乘时发生**上溢出**，我们就能让结果变得极其小，从而购买大量物品
- # 题解
	- 我们可以先购买大量的`A hair of the 4nsw3r`，然后出售获得大量金钱，最后购买flag
	- 要购买`A hair of the 4nsw3r`，我们只要利用上溢出让`user.go`中的乘法结果为1
	- 也就是说，我们需要找出`(999999*x) % (2 ** 64) == 1`中x的值，购买x个`A hair of the 4nsw3r`即可
	- 我们知道在模$2^{64}$乘法中，一个数有逆元当且仅当其和$2^{64}$互质
		- 逆元：$a$的逆元$a^{-1}$使得$a*a^{-1} \equiv 1(mod n)$
	- 10000000000000000000不和$2^{64}$互质，但999999和$2^{64}$互质
	- 用python求出999999的逆元
		- ```python
		  from gmpy2 import invert
		  print(invert(999999, 2 ** 64))
		  ```
	- 最后，我们只需要购买`invert(999999, 2 ** 64)`个`A hair of the 4nsw3r`即可获得大量金钱，最终购买flag